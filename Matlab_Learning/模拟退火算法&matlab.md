## 学习模拟退火算法&模拟退火算法在matlab中的具体实现

### 模拟退火算法概述

​		对于凸问题，局部最优解即为全局最优解，然而对于许多实际问题，属于**非凸**问题，并且随着问题规模的扩大，局部最优解的数目会迅速地增加。求解一般性的非凸目标函数的全局最优解至今仍是一个难题。求解全局优化问题的方法可分为两类，一类是确定性方法，另一类是随机性方法。确定性方法适用于求解具有一些特殊特征的问题，而梯度法和一般的随机搜索方法则沿着目标函数下降方向搜索，因此常常陷入局部而非全局最优解。

​		模拟退火算法是一种通用概率算法，用于在一个大的搜寻空间中寻找问题的最优解。其思想源于固体的退火过程，即将固体加热至足够高的问题，再缓慢冷却。在这一过程中，任一恒定温度都能达到热平衡是个重要步骤，这一点可以用Monte Carlo算法模拟，但使用Monte Carlo采样的工作量很大。考虑物理系统总是趋向于能量最低，而分子热运动趋向于破坏这种低能量的状态，故取贡献比较大的状态即可达到比较好的效果。故模拟退火算法采用一种重要性采样的方法。

​		具体而言，针对模拟退火算法，一般可以将温度T当作控制参数，目标函数值f视为内能E，而固体在某温度T时的一个状态对应一个解x。然后算法试图随着控制参数T的降低，使目标函数值f也逐渐降低，直至趋于全局最小值。

### 算法相关参数说明

+ 控制参数的初值$T_0$：冷却开始的温度。
+ 控制参数$T$的衰减函数：因计算机能够处理的都是离散数据，因此需要把连续的降温过程离散化成降温过程中的一系列温度点，衰减函数即计算这一系列温度的表达式。
+ 控制参数$T$的终值$T_f$（**停止准则**）
+ Markov链的长度$L_k$：任一温度T的迭代次数。

### 算法基本步骤

（1）令$T = T_0$，即开始退火的初始温度，随机生成一个初始解$x_0$，并计算相应的目标函数值$E(x_0)$。

（2）令$T$等于冷却进度表中的下一个值$T_i$。

（3）根据当前解$x_i$进行扰动（可针对扰动方式进行扩展延伸），产生一个新解$x_j$，计算相应的目标函数值$E(x_j)$，得到$\Delta E = E(x_j)-E(x_i)$。

（4）若$\Delta E < 0$，则新解$x_j$被接受，作为新的当前解；若$\Delta E > 0$，则新解$x_j$按概率$exp(-\Delta E/T_i)$接受，$T_i$为当前温度。（显然，$\Delta E$越小，$T_i$越大，则被接受的概率则相对而言更大些）

（5）在温度$T_i$下，重复$L_k$次的扰动和接受过程，即执行步骤(3)和(4)。

（6）判断$T$是否已经到达$T_f$，“是”则终止算法，“否”则跳转到步骤(2)继续执行。

**注意**：计算新解的目标函数值后会根据变化选择接不接受，由于算法初始温度比较高，那么在温度较高时，即使是使$E$增大的新解也可能被接受，且接受概率相对较大，因而能跳出局部极小值。另一方面，在温度较低时，即使接受函数已经非常小，但是仍有接受更差解的可能，因此一般会把退火过程中碰到的最好的可行解也记录下来，与终止算法前最后一个被接受的解一并输出。

### 算法的几点说明

+ **关于状态表达**

  ​		**状态表达**即实际问题的解以一种合适的数学形式被表达出来，它应当适用于SA的求解，同时又能充分表达实际问题，具体的设计方式可参照遗传算法中的编码方法。常见的表达方式有：背包问题和指派问题的0 - 1编码，TSP问题和调度问题的自然数编码，还有用于连续函数优化的实数编码等。

+ **关于新解产生**

  ​		新解产生机制的基本要求是能够尽量遍及空间的各个区域，这样能够更加有效地搜索全局最优解。

+ **收敛的一般性条件**

  ​		收敛到全局最优的一般性条件包括：

  （1）初始温度足够高；

  （2）热平衡时间足够长；

  （3）终止温度足够低；

  （4）降温过程足够缓慢。

+ **参数的选择**

  + **初始温度$T_0$**

    ​		为了达到算法要求，$T_0$一般要取值较大，这里大的含义不是绝对的，而是与问题规模相关的。过小的$T_0$往往无法跳出局部陷阱，但过大的$T_0$会增大计算量，因而会综合考虑。

  + **控制参数$T$的衰减函数**

    ​		**衰减函数**有多种形式，一个常见的衰减函数是
    $$
    T_{k+1} = \alpha T_k, k= 0,1,2,...
    $$
    ​		其中$\alpha$为常数，可以取为$0.5-0.99$，取值决定了降温过程。小的衰减量可能导致算法进行更多的轮次迭代，从而使算法进程接受更多的变换，进行更大范围的解空间搜索，这样有几率返回更好的最终解。

  + **Markov链的长度**

    ​		一般经验性而言，可令$L_k = 100n$，$n$为问题规模。

  + **终止温度**

    ​		一般$T_f$应设为一个足够小的整数，例如$0.01-5$

----

### 以TSP问题为例看模拟退火算法

+ **TSP问题的解空间和初始解**

  ​		TSP问题的解空间S是遍访每个城市恰好一次的所有回路，是所有城市排列的集合。即解空间S可表示为
  $$
  S = {(c_1,c_2,...,c_n)|(c_1,c_2,...,c_n)为{1,2,...,n}的排列}
  $$
  ​		其中每一个排列$s_i$表示遍访$n$个城市的一个路径，$c_i=j$表示第$i$次访问城市$j$。模拟退火算法的最优解和初始状态没有强的依赖关系，故初始解为随机函数生成一个$\{1,2,...,n\}$的随机排列作为$s_0$。

+ **目标函数**

  目标函数即路径总长度，也可称为代价函数
  $$
  C(c_1,c_2,...,c_n)=\sum_{i = 1}^{n-1}d(c_i,c_{i+1})+d(c_1,c_n)
  $$

+ **新解的产生**（Mark star）

  ​		新解的产生对问题的求解非常重要。新解可通过分别或者交替使用以下两种方法来产生：

  （1）二变换法：任选序号$u,v$（设$u<v<n$），交换$u$和$v$之间的访问顺序。

  （2）三变换法：任选序号$u,v,w$（设$u\leq v < \omega$），将$u$和$v$之间的路径插到$\omega$之后访问。

+ **目标函数差**

  计算变换前的解和变换后目标函数的差值：
  $$
  \Delta C^{'} =C(s_i^{'})-C(s_i)
  $$

+ **Metropolis接受准则**

  使用一般性的接受准则定义接受概率。
  
----

### 典型matlab代码程序结构

​		模拟退火算法的matlab代码实现在主框架步骤上是一致的，同目录下的SA_example.m文件给出了对特定TSP问题的模拟退火算法的求解代码。



  